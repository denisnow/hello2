<!doctype html>

<html lang="en">

	<head>
	
		<meta charset="utf-8">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">

		<style>
		
			body {
				font-family: "Roboto Mono", monospace;
				font-size: 15vw;
			}
			
		</style>

		<script>
		
			// ------------------------ Text module -----------------------------
		
			class Text extends HTMLElement {
			
				constructor() {
					super();

					this.attachShadow({mode: "open"});

					this.displayFirstChar = function() {
						setTimeout(() => {this.shadowRoot.textContent = this.dataset.text[0]}, 555);
					}
					
					this.displayNextChar = function() {
					
						let textToDisplay = this.dataset.text;
						let displayedText = this.shadowRoot.textContent;
						
						let isLastCharToDisplay = displayedText.length === textToDisplay.length-1;

							if (isLastCharToDisplay) shadowRootObserver.disconnect();
							
							let charToDisplay = textToDisplay[displayedText.length];		
							let previousChar = textToDisplay[displayedText.length-1];
							
							let delayLength = (charToDisplay === previousChar) ? 150 : 333 + Math.random() * 777;

							let addCharToDisplayedText = function() {
								this.shadowRoot.textContent += charToDisplay; 
								
							}.bind(this);

							setTimeout(addCharToDisplayedText, delayLength);
					}
					
					let shadowRootObserver = new MutationObserver(() => this.displayNextChar());
					
					shadowRootObserver.observe(this.shadowRoot, { attributes: false, childList: true, subtree: false });

					this.displayFirstChar();
				}
			}
			
			customElements.define("text-module", Text);

			// ------------------------ Cursor module ---------------------------

			class Cursor extends HTMLElement {
			
				constructor() {
					super();
					this.attachShadow({mode: "open"});

					this.cursorAnimate = function() {
						if (this.shadowRoot.textContent) this.shadowRoot.textContent = "";
						else this.shadowRoot.textContent = "_";
					}

					this.intervalID = setInterval(() => this.cursorAnimate(), 555);
				}
			}

			customElements.define("cursor-module", Cursor);
			
			// ------------------------------------------------------------------
		</script>

	</head>

	<body>
			
		<text-module data-text="hello"></text-module><cursor-module></cursor-module>

	</body>

</html>