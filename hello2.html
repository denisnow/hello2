<!doctype html>

<html lang="en">

	<head>

		<meta charset="utf-8">
		
		<style>
			@import url("https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap");
			text-module, cursor-module {
				font-family: "Roboto Mono", monospace;
				font-size: 15vw;
			}
		</style>

		<script>
			// ------------------------ Text module -----------------------------
		
			class Text extends HTMLElement {
			
				constructor() {
					super();
					
					let displayFirstChar = function() {
						setTimeout(() => this.textContent = this.dataset.text[0], 555);
					}.bind(this);
					
					let displayNextChar = function() {
					
						let textToDisplay = this.dataset.text;
						let displayedText = this.textContent;
						let charToDisplay = textToDisplay[displayedText.length];		
						let previousChar = textToDisplay[displayedText.length-1];
						
						let isLastCharToDisplay = displayedText.length === textToDisplay.length-1;
						
						let delayLength = (charToDisplay === previousChar) ? 150 : 333 + Math.random() * 777;
						
						let addCharToDisplayedText = function() {
							this.textContent += charToDisplay;
						}.bind(this);

						if (isLastCharToDisplay) observer.disconnect();

						setTimeout(addCharToDisplayedText, delayLength);
					}.bind(this);
					
					let observer = new MutationObserver(displayNextChar);
					
					observer.observe(this, {attributes: false, childList: true, subtree: false});

					displayFirstChar();
				}
			}
			
			customElements.define("text-module", Text);

			// ------------------------ Cursor module ---------------------------

			class Cursor extends HTMLElement {
			
				constructor() {
					super();
					
					let cursorAnimate = function() {
						if (this.textContent) this.textContent = "";
						else this.textContent = "_";
					}.bind(this);

					setTimeout(cursorAnimate, 1)
					this.intervalID = setInterval(cursorAnimate, 555);
				}
			}

			customElements.define("cursor-module", Cursor);
			
			// ------------------------------------------------------------------
		</script>

	</head>

	<body>
			
		<text-module data-text="hello"></text-module><cursor-module></cursor-module>
		
	</body>

</html>