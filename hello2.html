<!doctype html>

<html lang="en">

<head>

	<meta charset="utf-8">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">

	<script>
	
		// ------------------------ Text module -----------------------------
	
		class Text extends HTMLElement {
		
			constructor() {
				super();

				this.attachShadow({mode: "open"});
				
				//--------css--------
				
				let css  = '@import url("https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap");';
					css += 'text-module {';
					css += '	font-family: "Roboto Mono", monospace;';
					css += '	font-size: 15vw;';
					css += '}';
				let style = document.createElement('style');
				document.head.appendChild(style);
				style.type = 'text/css';
				style.appendChild(document.createTextNode(css));
				
				//-------------------
				
				this.displayFirstChar = function() {
					setTimeout(() => this.shadowRoot.textContent = this.dataset.text[0], 555);
				}
				
				this.displayNextChar = function() {
				
					let textToDisplay = this.dataset.text;
					let displayedText = this.shadowRoot.textContent;
					let charToDisplay = textToDisplay[displayedText.length];		
					let previousChar = textToDisplay[displayedText.length-1];
					
					let isLastCharToDisplay = displayedText.length === textToDisplay.length-1;
					
					let delayLength = (charToDisplay === previousChar) ? 150 : 333 + Math.random() * 777;
					
					let addCharToDisplayedText = function() {
						this.shadowRoot.textContent += charToDisplay;
					}.bind(this);

					if (isLastCharToDisplay) shadowRootObserver.disconnect();

					setTimeout(addCharToDisplayedText, delayLength);
				}
				
				let shadowRootObserver = new MutationObserver(() => this.displayNextChar());
				
				shadowRootObserver.observe(this.shadowRoot, {attributes: false, childList: true, subtree: false});

				this.displayFirstChar();
			}
		}
		
		customElements.define("text-module", Text);

		// ------------------------ Cursor module ---------------------------

		class Cursor extends HTMLElement {
		
			constructor() {
				super();
				
				//--------css--------
				
				let css  = '@import url("https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap");';
					css += 'cursor-module {';
					css += '	font-family: "Roboto Mono", monospace;';
					css += '	font-size: 15vw;';
					css += '}';
				let style = document.createElement('style');
				document.head.appendChild(style);
				style.type = 'text/css';
				style.appendChild(document.createTextNode(css));
				
				//-------------------
				
				this.attachShadow({mode: "open"});
				
				//let template = document.body.querySelector("#cursor-module").content.cloneNode(true);
				
				//this.shadowRoot.appendChild(template);

				this.cursorAnimate = function() {
					if (this.shadowRoot.textContent) this.shadowRoot.textContent = "";
					else this.shadowRoot.textContent = "_";
				}

				this.intervalID = setInterval(() => this.cursorAnimate(), 555);
			}
		}

		customElements.define("cursor-module", Cursor);
		
		// ------------------------------------------------------------------
	</script>

</head>

<body>
		
	<text-module data-text="hello"></text-module><cursor-module></cursor-module>

</body>

</html>